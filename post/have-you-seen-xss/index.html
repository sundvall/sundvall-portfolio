<!doctype html><html lang=en><head><title>Have you seen xss? - Martin Sundvall</title>
<link rel=canonical href=https://sundvall.github.io/sundvall-portfolio/post/have-you-seen-xss/><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="How to execute script in unprotected form input"><meta name=theme-color content="#FD3519"><link rel="shortcut icon" href=/sundvall-portfolio/images/portrait.jpeg type=image/x-icon><link rel=icon href=/sundvall-portfolio/images/portrait.jpeg type=image/x-icon><meta name=generator content="Hugo 0.120.4"><link rel=stylesheet href=https://sundvall.github.io/sundvall-portfolio/sass/style.min.eabe1aa4bd266a15f7b39b122bd6a5cc75cb067e5373631ac21d7815d6240d6f.css integrity="sha256-6r4apL0mahX3s5sSK9alzHXLBn5Tc2Mawh14FdYkDW8=" media=screen><link rel=stylesheet href=https://sundvall.github.io/sundvall-portfolio/syntax.min.css integrity media=screen><link rel=stylesheet href=/sundvall-portfolio/css/custom.css media=screen><meta property="og:title" content="Have you seen xss?"><meta property="og:description" content="How to execute script in unprotected form input"><meta property="og:type" content="article"><meta property="og:url" content="https://sundvall.github.io/sundvall-portfolio/post/have-you-seen-xss/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-11-14T12:05:01+02:00"><meta property="article:modified_time" content="2023-11-14T10:37:55+02:00"><meta itemprop=name content="Have you seen xss?"><meta itemprop=description content="How to execute script in unprotected form input"><meta itemprop=datePublished content="2023-11-14T12:05:01+02:00"><meta itemprop=dateModified content="2023-11-14T10:37:55+02:00"><meta itemprop=wordCount content="1387"><meta itemprop=keywords content></head><body><header style="background-image:linear-gradient( transparent,rgba(0,0,0,.8) ),url(https://sundvall.github.io/sundvall-portfolio/images/sandvik-vatten-4-regenerated.png)"><div class=intro><div class=logo-container><a href=/sundvall-portfolio><img src=https://sundvall.github.io/sundvall-portfolio/images/portrait.jpeg alt="Profile Caperio self-service web for workflow sofware" class=rounded-logo></a></div><h2>Hi, I'm Martin</h2><h3>I'm a Web Developer</h3><div class=menu><p><a href=/sundvall-portfolio/about/>About</a></p><p><a href=/sundvall-portfolio/portfolio/>Portfolio</a></p><p><a href=/sundvall-portfolio/post/>Posts</a></p></div></div><div class=socials><a href=https://github.com/sundvall class=social-link target=_blank rel=noopener><div class=icon><svg width="35" height="35" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img"><path d="M102.679.0H12.32C5.52.0.0 5.519.0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802.0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481.0 102.679.0zM71.182 98.494c-2.156.385-2.952-.95-2.952-2.053.0-1.386.051-8.471.051-14.195.0-4.005-1.335-6.546-2.9-7.881C74.878 73.313 84.89 72.003 84.89 55.6c0-4.671-1.669-7.007-4.39-10.01.436-1.105 1.9-5.648-.436-11.552-3.568-1.104-11.731 4.595-11.731 4.595-3.389-.95-7.06-1.438-10.679-1.438-3.62.0-7.29.488-10.679 1.438.0.0-8.163-5.699-11.73-4.595-2.337 5.878-.899 10.422-.437 11.551-2.72 3.004-4.004 5.34-4.004 10.011.0 16.326 9.574 17.712 19.072 18.765-1.232 1.104-2.336 3.003-2.72 5.724-2.44 1.104-8.677 3.004-12.4-3.568-2.335-4.056-6.545-4.39-6.545-4.39-4.159-.05-.282 2.619-.282 2.619 2.772 1.283 4.723 6.212 4.723 6.212 2.49 7.624 14.4 5.057 14.4 5.057.0 3.568.052 9.37.052 10.422.0 1.104-.77 2.438-2.952 2.053C27.21 92.821 15.35 76.701 15.35 57.86c0-23.564 18.02-41.456 41.585-41.456S99.598 34.296 99.598 57.86c.026 18.842-11.474 34.988-28.416 40.635zM46 82.81c-.488.103-.95-.102-1.001-.436-.051-.385.282-.719.77-.822.488-.05.95.154 1.001.488.077.334-.257.668-.77.77zm-2.439-.23c0 .333-.385.615-.898.615-.565.052-.95-.23-.95-.616.0-.333.385-.616.899-.616.487-.051.95.231.95.616zm-3.516-.283c-.103.334-.616.488-1.053.334-.488-.103-.821-.488-.719-.822.103-.334.617-.488 1.053-.385.513.154.847.54.719.873zm-3.158-1.386c-.23.282-.718.23-1.104-.154-.385-.334-.487-.822-.23-1.053.23-.282.718-.23 1.103.154.334.334.462.847.231 1.053zm-2.336-2.336c-.23.154-.667.0-.95-.385-.282-.385-.282-.822.0-1.001.283-.231.72-.052.95.333.283.385.283.847.0 1.053zm-1.668-2.49c-.231.23-.616.103-.899-.154-.282-.334-.333-.719-.102-.899.23-.23.616-.102.898.154.282.334.334.72.103.899zm-1.72-1.9c-.103.231-.436.283-.719.103-.334-.154-.488-.436-.385-.667.103-.154.385-.231.719-.103.334.18.488.462.385.667z"/></svg></div></a><a href=https://www.linkedin.com/in/martinsundvall/ class=social-link target=_blank rel=noopener><div class=icon><svg width="35" height="35" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img"><path d="M106.786.0H8.189C3.67.0.0 3.722.0 8.291v98.418C0 111.278 3.67 115 8.189 115h98.597c4.518.0 8.214-3.722 8.214-8.291V8.29C115 3.722 111.304.0 106.786.0zm-72.03 98.571H17.713V43.69h17.07V98.57h-.025zm-8.522-62.377c-5.467.0-9.882-4.44-9.882-9.883.0-5.442 4.415-9.882 9.882-9.882 5.442.0 9.883 4.44 9.883 9.882a9.87 9.87.0 01-9.883 9.883zm72.414 62.377H81.604V71.875c0-6.366-.129-14.555-8.856-14.555-8.882.0-10.242 6.931-10.242 14.093V98.57H45.46V43.69h16.352v7.495h.23c2.285-4.312 7.855-8.856 16.147-8.856 17.25.0 20.458 11.372 20.458 26.158V98.57z"/></svg></div></a></div></header><div class=mobile-header><p>Martin Sundvall</p><div class=hamburger><div class=bar></div><div class=bar></div><div class=bar></div></div></div><div class=overlay-menu><header><div class=intro><div class=logo-container><a href=/><img src=https://sundvall.github.io/sundvall-portfolio/images/portrait.jpeg alt="Profile Caperio self-service web for workflow sofware" class=rounded-logo></a></div><h2>Hi, I'm Martin</h2><h3>I'm a Web Developer</h3><div class=menu><p><a href=/sundvall-portfolio/about/>About</a></p><p><a href=/sundvall-portfolio/portfolio/>Portfolio</a></p><p><a href=/sundvall-portfolio/post/>Posts</a></p></div></div><div class=socials><a href=https://github.com/sundvall class=social-link target=_blank rel=noopener><div class=icon><svg width="35" height="35" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img"><path d="M102.679.0H12.32C5.52.0.0 5.519.0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802.0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481.0 102.679.0zM71.182 98.494c-2.156.385-2.952-.95-2.952-2.053.0-1.386.051-8.471.051-14.195.0-4.005-1.335-6.546-2.9-7.881C74.878 73.313 84.89 72.003 84.89 55.6c0-4.671-1.669-7.007-4.39-10.01.436-1.105 1.9-5.648-.436-11.552-3.568-1.104-11.731 4.595-11.731 4.595-3.389-.95-7.06-1.438-10.679-1.438-3.62.0-7.29.488-10.679 1.438.0.0-8.163-5.699-11.73-4.595-2.337 5.878-.899 10.422-.437 11.551-2.72 3.004-4.004 5.34-4.004 10.011.0 16.326 9.574 17.712 19.072 18.765-1.232 1.104-2.336 3.003-2.72 5.724-2.44 1.104-8.677 3.004-12.4-3.568-2.335-4.056-6.545-4.39-6.545-4.39-4.159-.05-.282 2.619-.282 2.619 2.772 1.283 4.723 6.212 4.723 6.212 2.49 7.624 14.4 5.057 14.4 5.057.0 3.568.052 9.37.052 10.422.0 1.104-.77 2.438-2.952 2.053C27.21 92.821 15.35 76.701 15.35 57.86c0-23.564 18.02-41.456 41.585-41.456S99.598 34.296 99.598 57.86c.026 18.842-11.474 34.988-28.416 40.635zM46 82.81c-.488.103-.95-.102-1.001-.436-.051-.385.282-.719.77-.822.488-.05.95.154 1.001.488.077.334-.257.668-.77.77zm-2.439-.23c0 .333-.385.615-.898.615-.565.052-.95-.23-.95-.616.0-.333.385-.616.899-.616.487-.051.95.231.95.616zm-3.516-.283c-.103.334-.616.488-1.053.334-.488-.103-.821-.488-.719-.822.103-.334.617-.488 1.053-.385.513.154.847.54.719.873zm-3.158-1.386c-.23.282-.718.23-1.104-.154-.385-.334-.487-.822-.23-1.053.23-.282.718-.23 1.103.154.334.334.462.847.231 1.053zm-2.336-2.336c-.23.154-.667.0-.95-.385-.282-.385-.282-.822.0-1.001.283-.231.72-.052.95.333.283.385.283.847.0 1.053zm-1.668-2.49c-.231.23-.616.103-.899-.154-.282-.334-.333-.719-.102-.899.23-.23.616-.102.898.154.282.334.334.72.103.899zm-1.72-1.9c-.103.231-.436.283-.719.103-.334-.154-.488-.436-.385-.667.103-.154.385-.231.719-.103.334.18.488.462.385.667z"/></svg></div></a><a href=https://www.linkedin.com/in/martinsundvall/ class=social-link target=_blank rel=noopener><div class=icon><svg width="35" height="35" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img"><path d="M106.786.0H8.189C3.67.0.0 3.722.0 8.291v98.418C0 111.278 3.67 115 8.189 115h98.597c4.518.0 8.214-3.722 8.214-8.291V8.29C115 3.722 111.304.0 106.786.0zm-72.03 98.571H17.713V43.69h17.07V98.57h-.025zm-8.522-62.377c-5.467.0-9.882-4.44-9.882-9.883.0-5.442 4.415-9.882 9.882-9.882 5.442.0 9.883 4.44 9.883 9.882a9.87 9.87.0 01-9.883 9.883zm72.414 62.377H81.604V71.875c0-6.366-.129-14.555-8.856-14.555-8.882.0-10.242 6.931-10.242 14.093V98.57H45.46V43.69h16.352v7.495h.23c2.285-4.312 7.855-8.856 16.147-8.856 17.25.0 20.458 11.372 20.458 26.158V98.57z"/></svg></div></a></div></header></div><div class=content-wrapper><div class=breadcrumb><span><a href=https://sundvall.github.io/sundvall-portfolio/>HOME</a>
/
</span><span><a href=https://sundvall.github.io/sundvall-portfolio/post/>POSTS</a>
/
</span><span class=active><a href=https://sundvall.github.io/sundvall-portfolio/post/have-you-seen-xss/>Have you seen xss?</a></span></div><main id=content class=post><h1>Have you seen xss?</h1><div class=reading-time><div class=icon><svg width="18" height="18" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img"><path d="M57.5 11C29.05 11 6 34.05 6 62.5S29.05 114 57.5 114 109 90.95 109 62.5 85.95 11 57.5 11zm0 93.032c-22.947.0-41.532-18.585-41.532-41.532S34.553 20.968 57.5 20.968 99.032 39.553 99.032 62.5 80.447 104.032 57.5 104.032zm12.833-21.68L52.703 69.54a2.508 2.508.0 01-1.018-2.015V33.427a2.5 2.5.0 012.492-2.492h6.646a2.5 2.5.0 012.492 2.492v29.426l13.871 10.092c1.122.81 1.35 2.368.54 3.49l-3.904 5.377a2.51 2.51.0 01-3.489.54z"/></svg></div><span>7 minutes</span></div><div class=published-date><div class=icon><svg width="18" height="18" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img"><path d="M77.577 51.23a1.807 1.807.0 00-2.2.342l-27.562 27.79a1.807 1.807.0 01-2.2.342l-14.008-9.702a1.807 1.807.0 00-2.2.342l-1.952 1.968c-.287.22-.456.568-.455.936.001.37.172.716.46.934L45.637 86.77a1.807 1.807.0 002.2-.342l31.709-31.97c.287-.22.456-.567.455-.936a1.175 1.175.0 00-.46-.933l-1.963-1.36z"/><path d="M97.304 20H80.512c-.041.34-.063.683-.064 1.026a5.986 5.986.0 001.256 4.1c.054.003.103.02.157.025a4.881 4.881.0 011.865-.025c3.05.562 4.984 3.907 4.32 7.47-.666 3.563-3.678 5.996-6.728 5.433a4.932 4.932.0 01-2.437-1.258c-6.018-1.378-10.445-7.795-10.445-15.745.0-.347.023-.685.04-1.026H34.579c-.041.34-.063.683-.064 1.026a5.986 5.986.0 001.256 4.1c.054.003.103.02.157.025a4.881 4.881.0 011.865-.025c3.05.562 4.984 3.907 4.32 7.47-.666 3.563-3.678 5.996-6.728 5.433a4.932 4.932.0 01-2.437-1.258c-6.018-1.378-10.445-7.795-10.445-15.745.0-.22.019-.434.025-.652a9.788 9.788.0 00-5.697 4.471 9.683 9.683.0 00-2.65 4.764L1.158 92.871c-.965 4.689 2.6 8.503 7.948 8.503h6.334v2.673c-.077 5.41 4.263 9.861 9.705 9.953h72.16c5.438-.095 9.774-4.546 9.694-9.953V29.953c.08-5.407-4.256-9.858-9.695-9.953zM10.078 96.653c-2.378.0-3.964-1.697-3.535-3.782L16.637 43.84h80.787L87.331 92.871a5.254 5.254.0 01-5.091 3.782H10.078zm91.535 7.394c.036 2.403-1.891 4.382-4.308 4.424h-72.16c-2.42-.04-4.352-2.018-4.32-4.424v-2.673h60.443c5.348.0 10.484-3.814 11.449-8.503l8.897-43.215v54.391z"/><path d="M34.814 33c1.243.0 2.251-1.057 2.251-2.36.0-1.305-1.008-2.362-2.25-2.362-2.04.0-4.313-3.194-4.313-7.778s2.272-7.778 4.312-7.778c1.227.0 2.536 1.163 3.386 3.084H43C41.716 11.19 38.578 8 34.814 8 29.871 8 26 13.49 26 20.5c0 7.009 3.871 12.5 8.814 12.5z"/></svg></div><span>November 14, 2023</span></div><p>Laboration to see XSS occur in webform.</p><p>&ldquo;Ok, I got the point about cross site scripting, but I want to see it.&rdquo;</p><p>Xss occurs when webform input is converted into javascript and executed in the context of the site. The protection is &ldquo;validation of input and sanitazon of output&rdquo;. But, how, does this really occur? How can this be tested? This post examines this.</p><h2 id=goal>goal</h2><p>How can an unprotected form be used to trigger an alert prompt?</p><h2 id=tldr>TL;DR</h2><p>When nonvalidated input is added to an element with &ldquo;innerHTML&rdquo; without replacement of special characters, it can be used to convert the text into javascript, due to browsers responsibility to convert markup into both text and scripts. Script are triggered when input is added to the DOM independent of the form is submitted.</p><ul><li>insertion of input like &lt;img src='x' onerror='alert(1)'> triggers alert prompt</li><li>insertion of input like &lt;script>alert(1);&lt;script> does not trigger alert prompt</li></ul><p>Xss is prevented by validation of input, and thereafter sanitized before further usage. The server must always redo this, but this is outside the scope of this article.</p><h3 id=the-vulnerability>The vulnerability</h3><p><em>Cross-site scripting (XSS) is a type of coding vulnerability. It is usually found in web applications. XSS enables attackers to inject malicious into web pages viewed by other users. XSS may allow attackers to bypass access controls such
as the same-origin policy may. This is one of the most common vulnerabilities found accordingly with OWASP Top 10. Symantec in its annual threat report found that XSS was the number two vulnerability found on web servers. The severity/risk of this vulnerability may range from a nuisance to a major security risk, depending on the sensitivity of the data handled by the vulnerable site and the nature of any security mitigation implemented by the site’s organization.</em><br><a href=https://owasp.org/www-project-code-review-guide/assets/OWASP_Code_Review_Guide_v2.pdf>OWASP code review</a></p><h2 id=xss-laboration-code>xss laboration code</h2><p>The laboration uses an unprotected form to test xss byt html injection.
The github example includes a local server to evaluate the data passed to the server.<br>Code: <a href=https://github.com/sundvall/security-labs>https://github.com/sundvall/security-labs</a></p><p>Alternative setups to test html injection may be found at <a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/11-Client-side_Testing/03-Testing_for_HTML_Injection#:~:text=This%20vulnerability%20occurs%20when%20user,HTML%20page%20to%20a%20victim.">Owasp</a></p><h3 id=the-html-and-javascript>The html and javascript</h3><p>The markup of the laboration consists of a form with a text-input. It&rsquo;s value is retrieved by the javascript click handler, and inserted into an output element.</p><p><a href=https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page>This doc from MDN is used to create output</a>
Other possibilities are &ldquo;setAttribute&rdquo; and &ldquo;createTextNode&rdquo;. The laboration intentionally make use of notorious &ldquo;innerHTML&rdquo;.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;post&#34;</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;/bar&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- input field --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>input</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;bad-input&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;foo-input&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=c>&lt;!-- submit --&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;innerhtml&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;innerHTML&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;textcontent&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;textcontent&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;sethtml&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;sethtml&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- element targeted for injection --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>output</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;the-output&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>output</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=scripts>Scripts</h3><p>Three clickhandlers are added to use three variations of insertion: innehHTML, textContent and setHTML.</p><p>Also other methods are cabable of text to script conversion. One of them is &ldquo;setInterval&rdquo;. This is added to the page and evaluates the forminput directly without any sanitazion and may be interrupted.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl>   <span class=c1>// Print the value as innerHTML to the output element
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#innerhtml&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=nx>event</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>event</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>badInputElm</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#bad-input&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>outputElm</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#the-output&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>outputElm</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=nx>badInputElm</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>  <span class=c1>// Print the value as innerHTML to the output element
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#textcontent&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=nx>event</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>event</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>badInputElm</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#bad-input&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>outputElm</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#the-output&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>outputElm</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=nx>badInputElm</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Print the value as setHTML to the output element requires sanitizer
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#sethtml&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=nx>event</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>event</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>badInputElm</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#bad-input&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>outputElm</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#the-output&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>defaultSanitizer</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Sanitizer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=nx>outputElm</span><span class=p>.</span><span class=nx>setHTML</span><span class=p>(</span><span class=nx>badInputElm</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span> <span class=p>{</span> <span class=nx>sanitizer</span><span class=o>:</span> <span class=nx>defaultSanitizer</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Evalute the form with setInterval:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>badInputElm</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#bad-input&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>timeId</span> <span class=o>=</span> <span class=nx>setInterval</span><span class=p>(</span><span class=nx>badInputElm</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span> <span class=mi>500</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#stop-timer&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>clearInterval</span><span class=p>(</span><span class=nx>timeId</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Evaluate the form with &#34;eval&#34;:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#evil-eval&#39;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;click&#39;</span><span class=p>,</span> <span class=nx>event</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>event</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>badInputElm</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#bad-input&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nb>eval</span><span class=p>(</span><span class=nx>badInputElm</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span></code></pre></div><h3 id=local-server>local server</h3><p>A local node server is created with express.js to investigate the data received serverside.
This is not important to see the xss occur, but is useful to reach further understanding of the interaction server-client.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/bar&#39;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;url:&#39;</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;post request: requestbody:&#39;</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;post query: :&#39;</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>sendFile</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>__dirname</span><span class=si>}</span><span class=sb>/public/index.html`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h2 id=testcases>testcases</h2><p>All testcases are found at <a href=https://html5sec.org/>https://html5sec.org/</a>.</p><h3 id=converts-to-javascript>converts to javascript</h3><p>All these strings are converted into javascript:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#39;x&#39;</span> <span class=na>onerror</span><span class=o>=</span><span class=s>&#39;alert(1)&#39;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;test&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>form</span><span class=p>&gt;&lt;</span><span class=nt>button</span> <span class=na>form</span><span class=o>=</span><span class=s>&#34;test&#34;</span> <span class=na>formaction</span><span class=o>=</span><span class=s>&#34;javascript:alert(&#39;what???&#39;)&#34;</span><span class=p>&gt;</span>Click here - execute exiting script!<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;test&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>form</span><span class=p>&gt;&lt;</span><span class=nt>button</span> <span class=na>form</span><span class=o>=</span><span class=s>&#34;test&#34;</span> <span class=na>formaction</span><span class=o>=</span><span class=s>&#34;javascript:console.log(&#39;what???&#39;)&#34;</span><span class=p>&gt;</span>Click here - execute exiting script!<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;test&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>form</span><span class=p>&gt;&lt;</span><span class=nt>button</span> <span class=na>form</span><span class=o>=</span><span class=s>&#34;test&#34;</span> <span class=na>formaction</span><span class=o>=</span><span class=s>&#34;javascript:fetch(&#39;http://localhost:3456&#39;).then((e,f)=&gt;console.log(e)).catch(f=&gt;console.log(f))&#34;</span><span class=p>&gt;</span>Click here - execute fetch!<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>input</span> <span class=na>onfocus</span><span class=o>=</span><span class=s>write(&#39;console&#39;)</span> <span class=na>autofocus</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>input</span> <span class=na>onfocus</span><span class=o>=</span><span class=s>write(&#39;console.log&#39;)</span> <span class=na>autofocus</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>video</span><span class=p>&gt;&lt;</span><span class=nt>source</span> <span class=na>onerror</span><span class=o>=</span><span class=s>&#34;alert(1)&#34;</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>This script has the effect of replacement of the entire content whenever &ldquo;tab&rdquo; or &ldquo;click&rdquo; is used:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>input</span> <span class=na>onfocus</span><span class=o>=</span><span class=s>write(1)</span> <span class=na>autofocus</span><span class=p>&gt;</span>// denna rad lägger till en nod så att när man klickar eller tabbar på sidan så byts allt innehåll till statement i &#39;write&#39;
</span></span></code></pre></div><p>This script prints a number, but only for &ldquo;x&rdquo; and does not work with for example &ldquo;alert(y)&rdquo;:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#39;x&#39;</span> <span class=na>onerror</span><span class=o>=</span><span class=s>&#39;alert(x)&#39;</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>This script replaces the current page with an svg:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;javascript:&amp;apos;&lt;svg onload&amp;equals;alert&amp;lpar;1&amp;rpar;&amp;nvgt;&amp;apos;&#34;</span><span class=p>&gt;</span>CLICK<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>This script gets the value of another element and adds it to a redirection:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#39;x&#39;</span> <span class=na>onerror</span><span class=o>=</span><span class=s>&#39;window.location.href=(document.querySelector(&#34;#treasure&#34;).value)&#39;</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=converts-partly-or-not-into-javascript>Converts partly or not into javascript</h2><p>If src=&lsquo;foo&rsquo; is replaced by src=&lsquo;x&rsquo; this converts into script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#39;foo&#39;</span> <span class=na>onerror</span><span class=o>=</span><span class=s>&#39;alert(1)&#39;</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>This script creates an input element which gives error in console:
&ldquo;Autofocus processing was blocked because a document already has a focused element.&rdquo;
When the element is focused another error is displayed:
&ldquo;Invalid or unexpected token (at (index):1:7)&rdquo;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>input</span> <span class=na>onfocus</span><span class=o>=</span><span class=s>write(&#39;all</span> <span class=na>content</span> <span class=na>visible</span> <span class=na>after</span> <span class=na>interaction</span><span class=err>&#39;)</span> <span class=na>autofocus</span><span class=p>&gt;</span>  
</span></span></code></pre></div><p>This script creates an input element. When the element is focused another error is displayed:
&ldquo;Unexpected token &lsquo;&lt;&rsquo; (at (index):1:7)&rdquo;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>input</span> <span class=na>onfocus</span><span class=o>=</span><span class=s>write(&lt;script</span><span class=p>&gt;</span>all text in the bodytag of a new document<span class=err>&lt;</span>/script) autofocus&gt;
</span></span></code></pre></div><p>This script creates an input element. When the element is focused another error is displayed:
&ldquo;Invalid or unexpected token (at (index):1:7)&rdquo;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>input</span> <span class=na>onfocus</span><span class=o>=</span><span class=s>write(&#39;all</span> <span class=na>content</span> <span class=na>visible</span> <span class=na>after</span> <span class=na>interaction</span><span class=err>&#39;)</span> <span class=na>autofocus</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>This script creates an input element. When the element is focused another error is displayed:
&ldquo;Invalid or unexpected token (at (index):1:7)&rdquo;
If only the &lsquo;console.log(1)&rsquo; remains, the entire page is replaced with this text.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>input</span> <span class=na>onfocus</span><span class=o>=</span><span class=s>write(&#39;console.log(1)</span> <span class=na>and</span> <span class=na>more</span><span class=err>&#39;)</span> <span class=na>autofocus</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>This script creates an input element. When the element is focused a script node is added to the dom, visible in devtools &ldquo;sources&rdquo;.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>input</span> <span class=na>onfocus</span><span class=o>=</span><span class=s>write(&#39;&lt;script</span><span class=p>&gt;</span>console.log(1)_and_more&#39;) autofocus&gt;
</span></span></code></pre></div><h2 id=the-treatment>The treatment</h2><p>To fully protect against xss in forms is out of the scope of this article. Some guiding links and advice follows.</p><h3 id=general-approach>General approach</h3><p><em>Search for all places where user input through a HTTP request could possibly make its way into the HTML output.</em><br><a href=https://developer.mozilla.org/en-US/docs/Learn/Forms/Form_validation>MDN</a></p><h3 id=what-does-the-library-provide>What does the library provide?</h3><p>It is useful to understand sequrity risks based on user input, to be able to take the adequate measures. It is valuable to be able to estimate the amount of safety measures that is enough for a specific application. For example, the framework <a href=https://angular.io/guide/security#preventing-cross-site-scripting-xss>Angular</a> provides protection against xss, and how much extra protective measures then have to be implemented?</p><h3 id=svgs-and-attributes>Svg&rsquo;s and attributes</h3><p><em>Be very careful when HTML attributes are used to carry HTML data that is later being used on the website"</em>
<em>Make sure that user submitted SVG data and SVG files are treated as XML documents - not as images. The nature of SVG allows to include almost arbitrary XML data including JavaScript leading to XSS or worse.</em>
<a href=https://html5sec.org/>https://html5sec.org/</a></p><h3 id=a-right-way-to-add-a-script-using-innerhtml>A right way to add a script using innerHTML</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>script</span><span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;script&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>script</span><span class=p>.</span><span class=nx>innerhtml</span><span class=o>=</span><span class=s2>&#34;&lt;script&gt; Your script here &lt;/script&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>element</span><span class=p>.</span><span class=nx>appendChild</span><span class=p>(</span> <span class=nx>script</span> <span class=p>);</span>
</span></span></code></pre></div><p><a href="https://www.tutorialspoint.com/can-scripts-be-inserted-with-innerhtml#:~:text=Inserting%20a%20script%20with%20innerHTML&amp;text=We%20cannot%20use%20the%20innerHTML,has%20to%20add%20a%20script.">tutorialspoint.com</a></p><h3 id=escape-special-characters-with-htmlentities>Escape special characters with htmlentities</h3><p>Some guiding text in the html is written with htmlentitites. Unless, it is transformed into code, which itself describes the problem this article and laboration is dedicated to.<br><a href=https://www.freeformatter.com/html-entities.html>more about html entities here</a></p><p>Example:
To write this line for an image tag&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#39;x&#39;</span> <span class=na>onerror</span><span class=o>=</span><span class=s>&#39;alert(1)&#39;</span><span class=p>&gt;</span>&#34;
</span></span></code></pre></div><p>&mldr;special characters must be replaced:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=ni>&amp;lt;</span>img<span class=ni>&amp;#32;</span>src<span class=ni>&amp;#61;&amp;#39;</span>x<span class=ni>&amp;#39;&amp;#32;</span>onerror<span class=ni>&amp;#61;&amp;#39;</span>alert<span class=ni>&amp;#40;</span>1<span class=ni>&amp;#41;&amp;#39;&amp;gt;</span>
</span></span></code></pre></div><h2 id=references>References</h2><p><a href=https://owasp.org/www-community/attacks/xss/>&ldquo;XSS Owasp&rdquo;</a></p><p>****&ldquo;search for all places where user input through a HTTP request could possibly make its way into the HTML output.&rdquo;
[MDN] (<a href=https://developer.mozilla.org/en-US/docs/Learn/Forms/Form_validation>https://developer.mozilla.org/en-US/docs/Learn/Forms/Form_validation</a>)</p><h4 id=owasp-code-review>Owasp Code review</h4><p>Especially page 73 about XSS in frameworks
and page 190 about clientside javascript.
<a href=https://owasp.org/www-project-code-review-guide/assets/OWASP_Code_Review_Guide_v2.pdf>Owasp codereview pdf</a></p><h3 id=owasp-cheatsheet>Owasp Cheatsheet</h3><p>This cheatsheet is a list of techniques to prevent or limit the impact of XSS. No single technique will solve XSS. Using the right combination of defensive techniques is necessary to prevent XSS.
Understand how your framework prevents XSS and where it has gaps. There will be times where you need to do something outside the protection provided by your framework. This is where Output Encoding and HTML Sanitization are critical. OWASP are producing framework specific cheatsheets for React, Vue, and Angular.<br><a href=https://cheatsheetseries.owasp.org/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html>Owasp cheatsheet</a></p><h3 id=general-info-about-webforms>General info about webforms</h3><p><a href=https://www.twilio.com/blog/everything-you-ever-wanted-to-know-about-secure-html-forms-html>More about forms</a></p><h3 id=more-testcases>More testcases</h3><p><a href=https://html5sec.org/>https://html5sec.org/</a></p></main></div><footer><div class=footer-wrapper><p>Made with ❤️ &mdash; Powered by <a href=https://gohugo.io/ target=_blank rel=external>Hugo</a> and the <a href=https://github.com/bjacquemet/personal-web target=_blank rel=external>Personal Web</a> theme. Icons come from the great <a href=https://fontawesome.com/license target=_blank rel=external>Font Awesome</a> library</p><p>© Martin Sundvall</p></div></footer><link href="https://fonts.googleapis.com/css?family=Montserrat:500,600|Raleway:400,400i,600" rel=stylesheet><script type=text/javascript>document.querySelector(".mobile-header").addEventListener("click",function(){var e=document.querySelector(".overlay-menu");document.querySelector(".hamburger").classList.contains("cross")?(document.querySelector(".hamburger").classList.remove("cross"),e.style.display="none",e.style.width="0%",e.style.height="0%"):(document.querySelector(".hamburger").classList.add("cross"),e.style.width="100%",e.style.height="100vh",e.style.display="block")})</script></body></html>